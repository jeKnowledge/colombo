<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.paypalobjects.com/api/checkout.js"></script>
</head>

<h1>Plan</h1>

<div class="form-material form-horizontal">

  <div class="form group">
    <label class="col-md-12">Company</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= @plan.auditor.company %></p>
    </div>
  </div>

  <div class="form group">
    <label class="col-md-12">Address</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= @plan.auditor.address %></p>
    </div>
  </div>

  <div class="form group">
    <label class="col-md-12">Products</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= @plan.products %></p>
    </div>
  </div>

  <div class="form group">
    <label class="col-md-12">Planned audit date</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= l @plan.date %></p>
    </div>
  </div>

  <div class="form group">
    <label class="col-md-12">Summary</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= @plan.summary %></p>
    </div>
  </div>

  <div class="form group">
    <label class="col-md-12">Price</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= @plan.price %></p>
    </div>
  </div>

  <div class="form group">
    <label class="col-md-12">Proposed fee</label>
    <div class="col-md-12">
      <p class="form-control form-control-line"><%= @plan.fee %></p>
    </div>
  </div>
  <div id="paypal-button-container"></div>
</div>

<script>
  paypal.Button.render({
    env: 'sandbox',
    commit: true,
    style: {
      label: 'checkout',  // horizontal | vertical
      size:   'responsive',    // medium | large | responsive
      shape:  'rect',      // pill | rect
      color:  'black'       // gold | blue | silver | black
    },
    payment: (data, actions) => {
      var CREATE_URL = "<%= paypal_checkout_url %>";
      var data = {
        items: [{
          name: "Plan",
          price: "<%= @plan.price %>",
          currency: "USD",
          quantity: "1"
        },
          {
            name: "Fee",
            price: "<%= @plan.fee %>",
            currency: "USD",
            quantity: "1"
          }],
        total_amount: "<%= @plan.price + @plan.fee %>",
        description: "<%= @plan.summary %>"
      }

      return actions.request.post(CREATE_URL, {data: JSON.stringify(data)})
        .then((res) => {
          return res.payment_id;
        });
    },
    onAuthorize: (data, actions) => {
      var EXECUTE_URL = "<%= paypal_execute_url %>";
      var data = {
        payment_id: data.paymentID,
        payer_id: data.payerID,
      };

      return actions.request.post(EXECUTE_URL, data)
        .then((res) => {
          if(res.success){
            window.location.replace("<%= client_reserve_url %>");
          }
        });
    }
  }, '#paypal-button-container');
</script>
